@page "/categories"
@using Microsoft.EntityFrameworkCore
@using Microsoft.AspNetCore.Components.QuickGrid
@using AutoPartsStore.Data
@implements IAsyncDisposable
@inject IDbContextFactory<AutoPartsStore.Data.AutoPartsContext> DbFactory

@using Microsoft.AspNetCore.Authorization
@attribute [Authorize(Roles = "Administrator,Manager")]

<PageTitle>Категории</PageTitle>

<div class="card mb-4">
    <div class="card-body">
        <h2 class="mb-4">Категории запчастей</h2>

        <div class="mb-3">
            <a href="categories/create" class="btn btn-sm btn-primary"><i class="bi bi-plus-circle me-1"></i> Создать новую категорию</a>
        </div>
    </div>
</div>

@if (context.Categories.Any())
{
    <QuickGrid Items="context.Categories.AsQueryable()" Class="table table-striped table-sm">
        <PropertyColumn Title="Название" Property="category => category.Name" />
        <PropertyColumn Title="Описание" Property="category => category.Description" />
        
        <TemplateColumn Title="Действия">
            <div class="d-flex gap-2">
                <a href="@($"categories/details?categoryid={context.CategoryId}")" 
                   class="btn btn-sm btn-outline-secondary"><i class="bi bi-eye me-1"></i>Подробнее</a>
                <a href="@($"categories/edit?categoryid={context.CategoryId}")" 
                   class="btn btn-sm btn-outline-primary"><i class="bi bi-pencil me-1"></i>Изменить</a>
                <a href="@($"categories/delete?categoryid={context.CategoryId}")" 
                   class="btn btn-sm btn-outline-danger"><i class="bi bi-trash me-1"></i>Удалить</a>
            </div>
        </TemplateColumn>
    </QuickGrid>
    
    <div class="mt-3 text-muted small">
        Всего категорий: @context.Categories.Count()
    </div>
}
else
{
    <div class="alert alert-info">
        <p class="mb-0">Нет доступных категорий. Добавьте первую категорию.</p>
    </div>
}

@code {
    private AutoPartsContext context = default!;

    protected override void OnInitialized()
    {
        context = DbFactory.CreateDbContext();
    }

    public async ValueTask DisposeAsync() => await context.DisposeAsync();
}